<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Questionnaire interactif" />
    <meta name="author" content="" />
    <title>{% block title %}Questionnaire{% endblock %}</title>

    {# Favicon #}
    <link rel="icon" type="image/x-icon" href="{{ asset('assets/favicon.ico') }}" />

    {# Bootstrap Icons #}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />

    {# Google Fonts #}
    <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic" rel="stylesheet" type="text/css" />

    {# SimpleLightbox CSS #}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css" rel="stylesheet" />

    {# Template CSS #}
    <link href="{{ asset('css/styles.css') }}" rel="stylesheet" />

    {# Custom CSS #}
    <link href="{{ asset('css/custom.css') }}" rel="stylesheet" />

    {% block stylesheets %}{% endblock %}
</head>
<body id="page-top">

    {# Navigation #}
    {% block navigation %}
    <nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" href="{{ path('app_home') }}">
                <i class="bi bi-clipboard-check"></i> Questionnaire
            </a>
            <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto my-2 my-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ path('app_home') }}">Accueil</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ path('app_choix') }}">Commencer</a>
                    </li>

                    {% if app.request.session.get('admin_authenticated') %}
                        {# Utilisateur connecté #}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ path('app_question_index') }}">
                                <i class="bi bi-gear"></i> Administration
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-danger" href="{{ path('admin_logout') }}">
                                <i class="bi bi-box-arrow-right"></i> Déconnexion
                            </a>
                        </li>
                    {% else %}
                        {# Utilisateur non connecté - Bouton qui ouvre le modal #}
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#adminLoginModal">
                                <i class="bi bi-lock"></i> Admin
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
    {% endblock %}

    {# Contenu principal #}
    {% block body %}{% endblock %}

    {# Modal de connexion Admin - Affiché uniquement si non connecté #}
    {% if not app.request.session.get('admin_authenticated') %}
    <div class="modal fade" id="adminLoginModal" tabindex="-1" aria-labelledby="adminLoginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="adminLoginModalLabel">
                        <i class="bi bi-shield-lock-fill"></i> Connexion Admin
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="post" action="{{ path('admin_login') }}">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="username" class="form-label">
                                <i class="bi bi-person"></i> Identifiant
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="username" 
                                   name="username" 
                                   placeholder="Entrez votre identifiant"
                                   required 
                                   autofocus>
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label">
                                <i class="bi bi-lock"></i> Mot de passe
                            </label>
                            <input type="password" 
                                   class="form-control" 
                                   id="password" 
                                   name="password" 
                                   placeholder="Entrez votre mot de passe"
                                   required>
                        </div>

                        <div class="alert alert-info small mb-0" role="alert">
                            <strong>Mode développement</strong><br>
                            Identifiant : <code>admin</code> | Mot de passe : <code>admin123</code>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle"></i> Annuler
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-box-arrow-in-right"></i> Se connecter
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endif %}

    {# Footer #}
    {% block footer %}
    <footer class="bg-light py-5">
        <div class="container px-4 px-lg-5">
            <div class="small text-center text-muted">
                Copyright &copy; {{ 'now'|date('Y') }} - Questionnaire App
            </div>
        </div>
    </footer>
    {% endblock %}

    {# Bootstrap core JS #}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

    {# SimpleLightbox plugin JS #}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.js"></script>

    {# Template JS #}
    <script src="{{ asset('js/scripts.js') }}"></script>

    {% block javascripts %}{% endblock %}
</body>
</html>