{% extends 'base.html.twig' %}

{% block title %}Dashboard Psychologue{% endblock %}

{% block body %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="dashboard-container">

    <h2>Bienvenue Dr. {{ app.user.nom }} {{ app.user.prenom }}</h2>

    <div class="icons-grid">
        <!-- Icon Dossiers Médicaux -->
        <div class="icon-box" onclick="window.location='{{ path('psy_dossiers_list') }}'">
            <i class="fas fa-folder-medical"></i>
            <span>Dossiers médicaux</span>
        </div>

        <!-- Icon Journal & Analyses IA -->
        <div class="icon-box" onclick="window.location='{{ path('psychologue_journals') }}'">
            <i class="fas fa-book-open"></i>
            <span>Journal &amp; analyses IA</span>
        </div>

        <!-- Icon Vocaux Patients -->
        <div class="icon-box" onclick="window.location='{{ path('psychologue_voice_cases') }}'">
            <i class="fas fa-headphones"></i>
            <span>Vocaux patients</span>
            {% if pendingVoiceCount|default(0) > 0 %}
                <small class="text-danger fw-bold">{{ pendingVoiceCount }} nouveau(x)</small>
            {% endif %}
        </div>

        <!-- Icon Profil -->
        <div class="icon-box" onclick="window.location='{{ path('psychologue_profil') }}'">
            <i class="fas fa-user-circle"></i>
            <span>Profil</span>
        </div>

    

        <!-- Icon Statistiques -->
        <div class="icon-box" onclick="window.location='{{ path('psychologue_stats_rdv') }}'">
            <i class="fas fa-chart-bar"></i>
            <span>Statistiques</span>
        </div>

        <!-- ✅ NOUVEAU : Icon Calendrier Bundle -->
        <div class="icon-box" onclick="window.location='{{ path('app_rendez_vous_calendrier_bundle') }}'">
            <i class="fas fa-calendar-alt"></i>
            <span>Mon calendrier</span>
        </div>
    </div>
    <!-- Liste des patients -->
    <div class="patients-section">
        <h3>Patients inscrits ({{ patients|length }})</h3>

        {% if patients is empty %}
            <div class="alert alert-info text-center py-4">
                <i class="fas fa-users fa-2x mb-3 d-block text-muted"></i>
                Aucun patient inscrit pour le moment
            </div>
        {% else %}
            <div class="list-group shadow">
                {% for patient in patients %}
                    <a href="{{ path('chat', {'id': patient.id}) }}"
                       class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-3">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-user-circle fa-2x text-primary me-3"></i>
                            <div>
                                <div class="fw-bold">{{ patient.prenom }} {{ patient.nom }}</div>
                                <small class="text-muted">
                                    {% if patient.dateNaissance %}
                                        Né(e) le {{ patient.dateNaissance|date('d/m/Y') }}
                                    {% else %}
                                        Date de naissance non renseignée
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                        <span class="badge bg-primary rounded-pill px-3 py-2">
                            Discuter
                        </span>
                    </a>
                {% endfor %}
            </div>
        {% endif %}
    </div>

</div>

<style>
.dashboard-container {
    background-color: rgba(208, 232, 255, 0.27);
    border-radius: 25px;
    padding: 30px 20px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 600px;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0 auto;
}

.icons-grid {
    display: flex;
    gap: 30px;
    margin-top: 40px;
    flex-wrap: wrap;
    justify-content: center;
}

.icon-box {
    width: 120px;
    height: 120px;
    background: white;
    border-radius: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: transform 0.2s;
}

.icon-box:hover { transform: scale(1.05); }

.icon-box i {
    font-size: 2rem;
    color: #2196f3;
    margin-bottom: 10px;
}

.icon-box span { font-weight: 600; text-align: center; }

.mt-4 { margin-top: 30px; }

.btn-danger { padding: 10px 20px; font-weight: bold; }
</style>
{% endblock %}