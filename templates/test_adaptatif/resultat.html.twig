{% extends 'base.html.twig' %}

{% block title %}Analyse Émotionnelle Avancée{% endblock %}

{% block body %}
<div class="container mt-5 mb-5">
    
    {# En-tête avec animation #}
    <div class="text-center mb-5 fade-in">
        <div class="mb-3">
            <i class="fa-solid fa-brain text-gradient" style="font-size: 5rem;"></i>
        </div>
        <h1 class="fw-bold display-4 mb-2">Analyse Émotionnelle Complète</h1>
        <p class="text-muted fs-5">Test adaptatif de {{ test.categorie|capitalize }}</p>
        <small class="text-muted">Analyse générée par Intelligence Artificielle</small>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-11">
            
            {# Score Principal - Card Modernisée #}
            <div class="card shadow-lg border-0 mb-4 card-score">
                <div class="card-body p-5 text-center">
                    <h5 class="text-uppercase text-muted mb-4 ls-wide">
                        <i class="fa-solid fa-chart-bar me-2"></i>Résultat Global
                    </h5>
                    
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <div class="score-display mb-3">
                                <span class="score-number">{{ test.scoreActuel }}</span>
                                <span class="score-max">/ {{ test.nombreQuestions * 3 }}</span>
                            </div>
                            <p class="text-muted mb-0">Score Total</p>
                        </div>
                        
                        <div class="col-md-8">
                            {# Barre de progression avancée #}
                            {% set percentage = (test.scoreActuel / (test.nombreQuestions * 3) * 100)|round %}
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <small class="text-muted">Niveau de détresse</small>
                                    <small class="fw-bold">{{ percentage }}%</small>
                                </div>
                                <div class="progress-modern">
                                    <div class="progress-bar-modern 
                                        {% if percentage < 33 %}bg-success-gradient
                                        {% elseif percentage < 66 %}bg-warning-gradient
                                        {% else %}bg-danger-gradient
                                        {% endif %}"
                                        style="width: {{ percentage }}%">
                                    </div>
                                </div>
                            </div>
                            
                            {# Badge de niveau #}
                            {% set moyenneParQ = test.scoreActuel / test.nombreQuestions %}
                            <div class="niveau-badge mt-3">
                                {% if moyenneParQ >= 2.5 %}
                                    <div class="alert alert-danger mb-0 d-inline-flex align-items-center px-4 py-2">
                                        <i class="fa-solid fa-triangle-exclamation fs-4 me-2"></i>
                                        <div>
                                            <strong>Niveau Critique</strong>
                                            <small class="d-block">Attention immédiate requise</small>
                                        </div>
                                    </div>
                                {% elseif moyenneParQ >= 1.5 %}
                                    <div class="alert alert-warning mb-0 d-inline-flex align-items-center px-4 py-2">
                                        <i class="fa-solid fa-exclamation-circle fs-4 me-2"></i>
                                        <div>
                                            <strong>Niveau Préoccupant</strong>
                                            <small class="d-block">Surveillance recommandée</small>
                                        </div>
                                    </div>
                                {% elseif moyenneParQ >= 0.8 %}
                                    <div class="alert alert-info mb-0 d-inline-flex align-items-center px-4 py-2">
                                        <i class="fa-solid fa-info-circle fs-4 me-2"></i>
                                        <div>
                                            <strong>Niveau Modéré</strong>
                                            <small class="d-block">Points à surveiller</small>
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="alert alert-success mb-0 d-inline-flex align-items-center px-4 py-2">
                                        <i class="fa-solid fa-check-circle fs-4 me-2"></i>
                                        <div>
                                            <strong>Niveau Faible</strong>
                                            <small class="d-block">État satisfaisant</small>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {# NOUVEAU: Graphique d'Évolution Émotionnelle #}
            <div class="card shadow-lg border-0 mb-4 card-graphique">
                <div class="card-header bg-gradient-primary text-white py-3">
                    <h5 class="mb-0">
                        <i class="fa-solid fa-chart-line me-2"></i>
                        Évolution Émotionnelle au fil du test
                    </h5>
                    <small>Visualisation animée de votre parcours émotionnel</small>
                </div>
                <div class="card-body p-4">
                    <canvas id="evolutionChart" height="80"></canvas>
                    
                    {# Légende personnalisée #}
                    <div class="row mt-4 text-center">
                        <div class="col-3">
                            <div class="legend-item">
                                <span class="legend-color bg-success"></span>
                                <small>Faible (0)</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="legend-item">
                                <span class="legend-color bg-info"></span>
                                <small>Modéré (1)</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="legend-item">
                                <span class="legend-color bg-warning"></span>
                                <small>Préoccupant (2)</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="legend-item">
                                <span class="legend-color bg-danger"></span>
                                <small>Critique (3)</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {# NOUVEAU: Statistiques Avancées #}
            {% if analyseEmotionnelle.statistiques is defined and analyseEmotionnelle.statistiques is not empty %}
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-header bg-light py-3">
                    <h5 class="mb-0">
                        <i class="fa-solid fa-calculator me-2"></i>Statistiques Détaillées
                    </h5>
                </div>
                <div class="card-body p-4">
                    <div class="row g-4">
                        <div class="col-md-3 col-6">
                            <div class="stat-card text-center p-3">
                                <i class="fa-solid fa-question-circle text-primary fs-2 mb-2"></i>
                                <h3 class="mb-0">{{ analyseEmotionnelle.statistiques.nombreQuestions }}</h3>
                                <small class="text-muted">Questions posées</small>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="stat-card text-center p-3">
                                <i class="fa-solid fa-chart-bar text-success fs-2 mb-2"></i>
                                <h3 class="mb-0">{{ analyseEmotionnelle.statistiques.scoreMoyen }}</h3>
                                <small class="text-muted">Score moyen</small>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="stat-card text-center p-3">
                                <i class="fa-solid fa-wave-square text-info fs-2 mb-2"></i>
                                <h3 class="mb-0">{{ analyseEmotionnelle.statistiques.ecartType }}</h3>
                                <small class="text-muted">Écart-type</small>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="stat-card text-center p-3">
                                <i class="fa-solid fa-clock text-warning fs-2 mb-2"></i>
                                <h3 class="mb-0">
                                    {% if analyseEmotionnelle.statistiques.duree %}
                                        {{ (analyseEmotionnelle.statistiques.duree / 60)|round }} min
                                    {% else %}
                                        -
                                    {% endif %}
                                </h3>
                                <small class="text-muted">Durée totale</small>
                            </div>
                        </div>
                    </div>
                    
                    {# Distribution des réponses #}
                    {% if analyseEmotionnelle.statistiques.distribution is defined %}
                    <div class="mt-4">
                        <h6 class="text-muted mb-3">Distribution des réponses</h6>
                        <div class="row">
                            <div class="col-md-3 mb-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-success px-3 py-2">Faible</span>
                                    <strong>{{ analyseEmotionnelle.statistiques.distribution.faible.count }} ({{ analyseEmotionnelle.statistiques.distribution.faible.pourcentage }}%)</strong>
                                </div>
                                <div class="progress mt-2" style="height: 6px;">
                                    <div class="progress-bar bg-success" style="width: {{ analyseEmotionnelle.statistiques.distribution.faible.pourcentage }}%"></div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-info px-3 py-2">Modéré</span>
                                    <strong>{{ analyseEmotionnelle.statistiques.distribution.modere.count }} ({{ analyseEmotionnelle.statistiques.distribution.modere.pourcentage }}%)</strong>
                                </div>
                                <div class="progress mt-2" style="height: 6px;">
                                    <div class="progress-bar bg-info" style="width: {{ analyseEmotionnelle.statistiques.distribution.modere.pourcentage }}%"></div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-warning px-3 py-2">Préoccupant</span>
                                    <strong>{{ analyseEmotionnelle.statistiques.distribution.preoccupant.count }} ({{ analyseEmotionnelle.statistiques.distribution.preoccupant.pourcentage }}%)</strong>
                                </div>
                                <div class="progress mt-2" style="height: 6px;">
                                    <div class="progress-bar bg-warning" style="width: {{ analyseEmotionnelle.statistiques.distribution.preoccupant.pourcentage }}%"></div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-danger px-3 py-2">Critique</span>
                                    <strong>{{ analyseEmotionnelle.statistiques.distribution.critique.count }} ({{ analyseEmotionnelle.statistiques.distribution.critique.pourcentage }}%)</strong>
                                </div>
                                <div class="progress mt-2" style="height: 6px;">
                                    <div class="progress-bar bg-danger" style="width: {{ analyseEmotionnelle.statistiques.distribution.critique.pourcentage }}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            {# NOUVEAU: Moments Critiques Identifiés #}
            {% if analyseEmotionnelle.momentsCritiques is defined and analyseEmotionnelle.momentsCritiques|length > 0 %}
            <div class="card shadow-lg border-0 mb-4 card-critical">
                <div class="card-header bg-gradient-danger text-white py-3">
                    <h5 class="mb-0">
                        <i class="fa-solid fa-exclamation-triangle me-2"></i>
                        Moments Critiques Identifiés ({{ analyseEmotionnelle.momentsCritiques|length }})
                    </h5>
                    <small>Points nécessitant une attention particulière</small>
                </div>
                <div class="card-body p-4">
                    {% for moment in analyseEmotionnelle.momentsCritiques %}
                    <div class="alert {% if moment.type == 'pic' and moment.gravite == 'critique' %}alert-danger{% elseif moment.type == 'pic' %}alert-warning{% else %}alert-info{% endif %} mb-3">
                        <div class="d-flex align-items-start">
                            <div class="me-3">
                                {% if moment.type == 'pic' %}
                                    <i class="fa-solid fa-circle-exclamation fs-3"></i>
                                {% elseif moment.type == 'changement_brusque' %}
                                    <i class="fa-solid fa-arrows-up-down fs-3"></i>
                                {% else %}
                                    <i class="fa-solid fa-layer-group fs-3"></i>
                                {% endif %}
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="alert-heading mb-2">
                                    {% if moment.type == 'pic' %}
                                        Question {{ moment.numero }}: {{ moment.gravite|upper }}
                                    {% elseif moment.type == 'changement_brusque' %}
                                        Changement Brusque (Q{{ moment.numero }})
                                    {% else %}
                                        Séquence Critique (Q{{ moment.debut }}-Q{{ moment.fin }})
                                    {% endif %}
                                </h6>
                                <p class="mb-2">{{ moment.description }}</p>
                                {% if moment.question is defined %}
                                    <small class="text-muted d-block"><strong>Q:</strong> {{ moment.question }}</small>
                                    <small class="text-muted"><strong>R:</strong> {{ moment.reponse }} ({{ moment.valeur }} pts)</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {# NOUVEAU: Analyse de Tendances #}
            {% if analyseEmotionnelle.tendances is defined and analyseEmotionnelle.tendances.type != 'insuffisant' %}
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-header bg-gradient-info text-white py-3">
                    <h5 class="mb-0">
                        <i class="fa-solid fa-trending-up me-2"></i>Analyse des Tendances
                    </h5>
                </div>
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-4 text-center">
                            <div class="tendance-icon mb-3">
                                {% if analyseEmotionnelle.tendances.type == 'aggravation' %}
                                    <i class="fa-solid fa-arrow-trend-up text-danger" style="font-size: 4rem;"></i>
                                {% elseif analyseEmotionnelle.tendances.type == 'amelioration' %}
                                    <i class="fa-solid fa-arrow-trend-down text-success" style="font-size: 4rem;"></i>
                                {% else %}
                                    <i class="fa-solid fa-arrows-left-right text-info" style="font-size: 4rem;"></i>
                                {% endif %}
                            </div>
                            <h4 class="text-uppercase">{{ analyseEmotionnelle.tendances.type }}</h4>
                        </div>
                        <div class="col-md-8">
                            <p class="lead mb-3">{{ analyseEmotionnelle.tendances.description }}</p>
                            <p class="mb-2"><strong>Régularité:</strong> {{ analyseEmotionnelle.tendances.regularite.description }}</p>
                            <hr>
                            <h6 class="text-muted mb-2">Conseils personnalisés:</h6>
                            <ul class="list-unstyled">
                                {% for conseil in analyseEmotionnelle.tendances.conseils %}
                                <li class="mb-2">
                                    <i class="fa-solid fa-check-circle text-success me-2"></i>{{ conseil }}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            {# Analyse IA Textuelle #}
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-header bg-gradient-purple text-white py-3">
                    <h5 class="mb-0">
                        <i class="fa-solid fa-robot me-2"></i>Analyse Psychologique par IA
                    </h5>
                    <small>Générée par Groq AI (llama-3.3-70b-versatile)</small>
                </div>
                <div class="card-body p-4">
                    <div class="analysis-text">{{ analyse }}</div>
                </div>
            </div>

            {# NOUVEAU: Recommandations Personnalisées #}
            {% if analyseEmotionnelle.recommendations is defined and analyseEmotionnelle.recommendations|length > 0 %}
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-header bg-gradient-success text-white py-3">
                    <h5 class="mb-0">
                        <i class="fa-solid fa-lightbulb me-2"></i>Recommandations Thérapeutiques
                    </h5>
                </div>
                <div class="card-body p-4">
                    {% for reco in analyseEmotionnelle.recommendations %}
                    <div class="recommendation-card mb-4 p-4 border-start border-5 
                        {% if reco.priorite == 'urgente' %}border-danger bg-danger-subtle
                        {% elseif reco.priorite == 'importante' %}border-warning bg-warning-subtle
                        {% else %}border-info bg-info-subtle
                        {% endif %}">
                        <div class="d-flex align-items-start">
                            <div class="me-3">
                                <i class="fa-solid {{ reco.icone }} fs-2 {% if reco.priorite == 'urgente' %}text-danger{% elseif reco.priorite == 'importante' %}text-warning{% else %}text-info{% endif %}"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h5 class="mb-2">
                                    {{ reco.titre }}
                                    {% if reco.priorite == 'urgente' %}
                                        <span class="badge bg-danger ms-2">URGENT</span>
                                    {% elseif reco.priorite == 'importante' %}
                                        <span class="badge bg-warning ms-2">IMPORTANT</span>
                                    {% endif %}
                                </h5>
                                <p class="mb-3">{{ reco.description }}</p>
                                <div class="recommendation-actions">
                                    <h6 class="text-muted mb-2">Actions recommandées :</h6>
                                    <ul class="mb-0">
                                        {% for action in reco.actions %}
                                        <li class="mb-1">{{ action }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {# Chronologie Détaillée (pliable) #}
            {% if analyseEmotionnelle.chronologie is defined and analyseEmotionnelle.chronologie|length > 0 %}
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-header bg-light py-3">
                    <h5 class="mb-0">
                        <a class="text-decoration-none text-dark" data-bs-toggle="collapse" href="#chronologieCollapse" role="button" aria-expanded="false">
                            <i class="fa-solid fa-list-check me-2"></i>
                            Chronologie Détaillée ({{ analyseEmotionnelle.chronologie|length }} questions)
                            <i class="fa-solid fa-chevron-down float-end"></i>
                        </a>
                    </h5>
                </div>
                <div class="collapse" id="chronologieCollapse">
                    <div class="card-body p-4">
                        <div class="timeline">
                            {% for item in analyseEmotionnelle.chronologie %}
                            <div class="timeline-item mb-4">
                                <div class="d-flex align-items-start">
                                    <div class="timeline-marker me-3">
                                        <span class="badge bg-{{ item.couleur }} rounded-circle p-3">{{ item.numero }}</span>
                                    </div>
                                    <div class="flex-grow-1 timeline-content">
                                        <div class="card border-{{ item.couleur }}">
                                            <div class="card-body p-3">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <span class="badge bg-{{ item.couleur }} mb-2">{{ item.niveau }} ({{ item.valeur }} pts)</span>
                                                    <small class="text-muted">Score cumulé: {{ item.scoreCumule }}</small>
                                                </div>
                                                <p class="mb-2 fw-bold">{{ item.question }}</p>
                                                <p class="mb-0 text-muted">
                                                    <i class="fa-solid fa-arrow-right text-{{ item.couleur }} me-2"></i>
                                                    {{ item.reponse }}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            {# Actions #}
            <div class="text-center mb-5">
                {# Boutons de téléchargement PDF #}
                <div class="mb-4">
                    <a href="{{ path('test_pdf_preview', {id: test.id}) }}" class="btn btn-outline-info btn-lg px-4 me-2 mb-2" target="_blank">
                        <i class="fa-solid fa-eye"></i> Prévisualiser le PDF
                    </a>
                    <a href="{{ path('test_pdf_download', {id: test.id}) }}" class="btn btn-success btn-lg px-4 me-2 mb-2">
                        <i class="fa-solid fa-file-pdf"></i> Télécharger le PDF
                    </a>
                </div>
                
                <a href="{{ path('test_page') }}" class="btn btn-primary btn-lg px-5 me-2 mb-2">
                    <i class="fa-solid fa-rotate"></i> Nouveau Test
                </a>
                
                {% if app.user %}
                <a href="{{ path('app_test_adaptatif_historique') }}" class="btn btn-outline-primary btn-lg px-5 me-2 mb-2">
                    <i class="fa-solid fa-history"></i> Mon Historique
                </a>
                {% endif %}
            </div>

        </div>
    </div>

</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}

{# Chart.js CDN #}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
// Données du graphique
const chartData = {{ analyseEmotionnelle.graphiqueData|json_encode|raw }};

// Vérifier que les données existent avant de créer le graphique
if (chartData && chartData.datasets && chartData.datasets.length >= 2) {
    // Configuration du graphique d'évolution
    const ctx = document.getElementById('evolutionChart');

    const evolutionChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: chartData.labels,
            datasets: [
                {
                    label: 'Score par question',
                    data: chartData.datasets[0].data,
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: function(context) {
                        const value = context.parsed?.y;
                        if (value === 0) return 'rgba(40, 167, 69, 0.6)';
                        if (value === 1) return 'rgba(23, 162, 184, 0.6)';
                        if (value === 2) return 'rgba(255, 193, 7, 0.6)';
                        return 'rgba(220, 53, 69, 0.6)';
                    },
                    borderWidth: 3,
                    pointRadius: 6,
                    pointHoverRadius: 10,
                    pointBackgroundColor: function(context) {
                        const value = context.parsed?.y;
                        if (value === 0) return 'rgb(40, 167, 69)';
                        if (value === 1) return 'rgb(23, 162, 184)';
                        if (value === 2) return 'rgb(255, 193, 7)';
                        return 'rgb(220, 53, 69)';
                    },
                    tension: 0.4
                },
                {
                    label: 'Score cumulé',
                    data: chartData.datasets[1].data,
                    borderColor: 'rgba(153, 102, 255, 1)',
                    backgroundColor: 'rgba(153, 102, 255, 0.1)',
                    borderWidth: 2,
                    pointRadius: 4,
                    tension: 0.4,
                    fill: true
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            interaction: {
                intersect: false,
                mode: 'index'
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        font: {
                            size: 14,
                            weight: 'bold'
                        },
                        padding: 20,
                        usePointStyle: true
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 15,
                    titleFont: {
                        size: 16
                    },
                    bodyFont: {
                        size: 14
                    },
                    callbacks: {
                        title: function(context) {
                            return 'Question ' + (context[0].dataIndex + 1);
                        },
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            label += context.parsed.y;
                            
                            // Ajouter le niveau émotionnel
                            if (context.datasetIndex === 0) {
                                const value = context.parsed.y;
                                let niveau = '';
                                if (value === 0) niveau = ' (Faible)';
                                else if (value === 1) niveau = ' (Modéré)';
                                else if (value === 2) niveau = ' (Préoccupant)';
                                else niveau = ' (Critique)';
                                label += niveau;
                            }
                            
                            return label;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: function(context) {
                        // Déterminer le max dynamiquement
                        const maxCumule = Math.max(...chartData.datasets[1].data);
                        const maxQuestion = 3;
                        return Math.max(maxCumule, maxQuestion) + 1;
                    },
                    ticks: {
                        stepSize: 1,
                        font: {
                            size: 12
                        }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                },
                x: {
                    ticks: {
                        font: {
                            size: 12,
                            weight: 'bold'
                        }
                    },
                    grid: {
                        display: false
                    }
                }
            },
            animation: {
                duration: 2000,
                easing: 'easeInOutQuart'
            }
        }
    });
}

// Animation au chargement
document.addEventListener('DOMContentLoaded', function() {
    // Scroll animation
    const cards = document.querySelectorAll('.card');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('fade-in-visible');
            }
        });
    }, {
        threshold: 0.1
    });
    
    cards.forEach(card => {
        observer.observe(card);
    });
});
</script>
{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
/* Variables CSS */
:root {
    --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --gradient-success: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
    --gradient-danger: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
    --gradient-info: linear-gradient(135deg, #2193b0 0%, #6dd5ed 100%);
    --gradient-warning: linear-gradient(135deg, #f09819 0%, #edde5d 100%);
}

/* Animations */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.fade-in {
    animation: fadeInUp 0.8s ease forwards;
}

.card {
    opacity: 0;
    animation: fadeInUp 0.6s ease forwards;
}

.card:nth-child(1) { animation-delay: 0.1s; }
.card:nth-child(2) { animation-delay: 0.2s; }
.card:nth-child(3) { animation-delay: 0.3s; }
.card:nth-child(4) { animation-delay: 0.4s; }
.card:nth-child(5) { animation-delay: 0.5s; }
.card:nth-child(6) { animation-delay: 0.6s; }
.card:nth-child(7) { animation-delay: 0.7s; }

.fade-in-visible {
    opacity: 1 !important;
}

/* Carte Score */
.card-score {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    border-radius: 25px;
}

.score-number {
    font-size: 5rem;
    font-weight: 800;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    display: inline-block;
}

.score-max {
    font-size: 2.5rem;
    color: #6c757d;
    font-weight: 600;
}

/* Barre de progression moderne */
.progress-modern {
    height: 20px;
    background: #e9ecef;
    border-radius: 50px;
    overflow: hidden;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
}

.progress-bar-modern {
    height: 100%;
    border-radius: 50px;
    transition: width 2s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.bg-success-gradient {
    background: var(--gradient-success);
}

.bg-warning-gradient {
    background: var(--gradient-warning);
}

.bg-danger-gradient {
    background: var(--gradient-danger);
}

/* En-têtes de cartes */
.bg-gradient-primary {
    background: var(--gradient-primary);
}

.bg-gradient-success {
    background: var(--gradient-success);
}

.bg-gradient-danger {
    background: var(--gradient-danger);
}

.bg-gradient-info {
    background: var(--gradient-info);
}

.bg-gradient-purple {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

/* Texte avec gradient */
.text-gradient {
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Cartes statistiques */
.stat-card {
    background: #f8f9fa;
    border-radius: 15px;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    border-color: #667eea;
}

.stat-card h3 {
    font-size: 2rem;
    font-weight: 700;
    color: #2c3e50;
}

/* Cartes de recommandations */
.recommendation-card {
    border-radius: 15px;
    transition: all 0.3s ease;
}

.recommendation-card:hover {
    transform: translateX(5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.bg-danger-subtle {
    background-color: rgba(220, 53, 69, 0.05);
}

.bg-warning-subtle {
    background-color: rgba(255, 193, 7, 0.05);
}

.bg-info-subtle {
    background-color: rgba(23, 162, 184, 0.05);
}

/* Timeline */
.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 20px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: linear-gradient(to bottom, #667eea, #764ba2);
}

.timeline-item {
    position: relative;
}

.timeline-marker {
    position: absolute;
    left: -28px;
    z-index: 1;
}

.timeline-marker .badge {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    font-weight: 700;
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
}

.timeline-content {
    margin-left: 40px;
}

.timeline-content .card {
    transition: all 0.3s ease;
    border-width: 2px;
}

.timeline-content .card:hover {
    transform: translateX(5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
}

/* Légende du graphique */
.legend-item {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.legend-color {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: inline-block;
}

/* Analyse textuelle */
.analysis-text {
    white-space: pre-wrap;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 1rem;
    line-height: 1.8;
    background: #f8f9fa;
    padding: 25px;
    border-radius: 15px;
    border-left: 5px solid #667eea;
}

/* Utility classes */
.ls-wide {
    letter-spacing: 2px;
}

/* Responsive */
@media (max-width: 768px) {
    .score-number {
        font-size: 3rem;
    }
    
    .score-max {
        font-size: 1.5rem;
    }
    
    .timeline {
        padding-left: 15px;
    }
    
    .timeline-content {
        margin-left: 20px;
    }
}

/* Print styles */
@media print {
    .btn, nav, footer, .no-print {
        display: none !important;
    }
    
    .card {
        page-break-inside: avoid;
        box-shadow: none !important;
        border: 1px solid #dee2e6;
    }
    
    body {
        background: white !important;
    }
}
</style>
{% endblock %}
